#!/usr/bin/env python3
'''Gsub

  Submit job-scripts.

Usage:
  Gsub [options] <FILES>...

Arguments:
  <FILES>...          Job-scripts

Options:
  --verbose           Print commands to screen, without executing.
  -h --help           Show help.
  --version           Show version.

Copyright:
  T.W.J. de Geus
  tom@geus.me
  www.geus.me
'''

# ==================================================================================================

import docopt, os, sys, re, subprocess

# parse command-line options
# --------------------------

# function to raise error
def Error(txt):
  print(txt)
  sys.exit(1)

# parse command-line options
args = docopt.docopt(__doc__,version='0.0.1')

# check
# -----

for file in args['<FILES>']:

  if not os.path.isfile(file):
    Error('"%s" does not exist' % file)

# submit
# ------

for file in args['<FILES>']:

  path, name = os.path.split(file)

  if len(path) > 0 : cmd = 'cd %s; sbatch %s' % ( path, name )
  else             : cmd = 'sbatch %s'        % ( name       )

  print(cmd)

  if not args['--verbose']:
    print(subprocess.check_output(cmd,shell=True).decode('utf-8'),end='')
